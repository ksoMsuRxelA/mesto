(()=>{"use strict";function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var t=function(){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this._popupSelector=e,this._element=document.querySelector(e),this._handleEscClose=this._handleEscClose.bind(this)}var n,o;return n=t,(o=[{key:"open",value:function(){this._element.classList.add("popup_opened"),document.addEventListener("keydown",this._handleEscClose)}},{key:"close",value:function(){this._element.classList.remove("popup_opened"),document.removeEventListener("keydown",this._handleEscClose)}},{key:"setEventListeners",value:function(){this._element.querySelector(".popup__close-button").addEventListener("click",this.close.bind(this)),this._element.addEventListener("mousedown",this._handleClickClose.bind(this))}},{key:"_handleEscClose",value:function(e){"Escape"===e.key&&this.close()}},{key:"_handleClickClose",value:function(e){e.target.classList.contains("popup")&&this.close()}}])&&e(n.prototype,o),t}(),n=document.querySelector(".page"),o=n.querySelector(".content"),r=(o.querySelector(".elements").querySelectorAll(".element"),n.querySelector(".popup_type_edit").querySelector(".popup__container").querySelector(".popup__edit-form")),i=(r.querySelector(".popup__close-button"),r.querySelector(".popup__input-name")),c=r.querySelector(".popup__input-role"),u=n.querySelector(".popup_type_new-card"),a=(u.querySelector(".popup__container"),u.querySelector(".popup__edit-form")),l=(u.querySelector(".popup__close-button"),u.querySelector(".popup__input-name"),u.querySelector(".popup__input-link"),n.querySelector(".popup_type_image")),s=(l.querySelector(".popup__container"),l.querySelector(".popup__image"),l.querySelector(".popup__image-caption"),l.querySelector(".popup__close-button"),o.querySelector(".profile")),f=s.querySelector(".profile__edit-button"),p=s.querySelector(".profile__add-button"),_=s.querySelector(".profile__full-name"),h=s.querySelector(".profile__role"),d=s.querySelector(".profile__avatar"),y=".elements",m=n.querySelector(".popup_type_avatar").querySelector(".popup__edit-form"),b={formSelector:".popup__edit-form",inputSelector:".popup__input",submitButtonSelector:".popup__save-button",inactiveButtonClass:"popup__save-button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error-element_visible"};function v(e){return(v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function S(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function k(e,t,n){return(k="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var o=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=w(e)););return e}(e,t);if(o){var r=Object.getOwnPropertyDescriptor(o,t);return r.get?r.get.call(n):r.value}})(e,t,n||e)}function E(e,t){return(E=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function g(e,t){return!t||"object"!==v(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function w(e){return(w=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var C=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&E(e,t)}(c,e);var t,n,o,r,i=(o=c,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=w(o);if(r){var n=w(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return g(this,e)});function c(e,t,n){var o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c),(o=i.call(this,t))._handleFormSubmit=e,o._handleFormClose=n,o._formElement=o._element.querySelector(".popup__edit-form"),o}return t=c,(n=[{key:"_getInputValues",value:function(){var e=this;return this._inputList=this._formElement.querySelectorAll(".popup__input"),this._formValues={},this._inputList.forEach((function(t){e._formValues[t.name]=t.value})),this._formValues}},{key:"setEventListeners",value:function(){var e=this;k(w(c.prototype),"setEventListeners",this).call(this),this._formElement.addEventListener("submit",(function(t){t.preventDefault(),e._formElement.querySelector(".popup__save-button").textContent="Сохранить...",e._handleFormSubmit(e._getInputValues())}))}},{key:"close",value:function(){k(w(c.prototype),"close",this).call(this),this._handleFormClose(),this._formElement.querySelector(".popup__save-button").textContent="Сохранить",this._formElement.reset()}}])&&S(t.prototype,n),c}(t);function L(e){return(L="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function O(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function j(e,t,n){return(j="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var o=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=I(e)););return e}(e,t);if(o){var r=Object.getOwnPropertyDescriptor(o,t);return r.get?r.get.call(n):r.value}})(e,t,n||e)}function q(e,t){return(q=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function P(e,t){return!t||"object"!==L(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function I(e){return(I=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var R=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&q(e,t)}(c,e);var t,n,o,r,i=(o=c,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=I(o);if(r){var n=I(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return P(this,e)});function c(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c),(t=i.call(this,e))._popupImg=t._element.querySelector(".popup__image"),t._popupCaption=t._element.querySelector(".popup__image-caption"),t}return t=c,(n=[{key:"open",value:function(e,t,n){this._popupImg.src=e,this._popupImg.alt=t,this._popupCaption.textContent=n,j(I(c.prototype),"open",this).call(this)}}])&&O(t.prototype,n),c}(t);function T(e){return(T="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function x(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function B(e,t,n){return(B="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var o=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=V(e)););return e}(e,t);if(o){var r=Object.getOwnPropertyDescriptor(o,t);return r.get?r.get.call(n):r.value}})(e,t,n||e)}function U(e,t){return(U=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function F(e,t){return!t||"object"!==T(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function V(e){return(V=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var A=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&U(e,t)}(c,e);var t,n,o,r,i=(o=c,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=V(o);if(r){var n=V(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return F(this,e)});function c(e,t){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c),(n=i.call(this,t))._handleFormSubmit=e,n._formElement=n._element.querySelector(".popup__edit-form"),n}return t=c,(n=[{key:"setHandleFormSubmit",value:function(e){this._handleFormSubmit=e}},{key:"setEventListeners",value:function(){var e=this;B(V(c.prototype),"setEventListeners",this).call(this),this._formElement.addEventListener("submit",(function(t){t.preventDefault(),e._formElement.querySelector(".popup__save-button").textContent="Да...",e._handleFormSubmit()}))}},{key:"close",value:function(){B(V(c.prototype),"close",this).call(this),this._formElement.querySelector(".popup__save-button").textContent="Да"}}])&&x(t.prototype,n),c}(t);function D(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var N=function(){function e(t){var n=t.nameSelector,o=t.roleSelector;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._nameElement=document.querySelector(n),this._roleElement=document.querySelector(o)}var t,n;return t=e,(n=[{key:"getUserInfo",value:function(){return{name:this._nameElement.textContent,about:this._roleElement.textContent}}},{key:"setUserInfo",value:function(e){this._nameElement.textContent=e.name,this._roleElement.textContent=e.about}}])&&D(t.prototype,n),e}();function H(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var J=function(){function e(t,n){var o=t.items,r=t.renderer;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._renderedItems=o,this._renderer=r,this._containerSelector=n}var t,n;return t=e,(n=[{key:"addItem",value:function(e){document.querySelector(this._containerSelector).prepend(e)}},{key:"renderItems",value:function(){var e=this;this._renderedItems.forEach((function(t){e._renderer(t)}))}}])&&H(t.prototype,n),e}();function G(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function z(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const M=function(){function e(t,n,o,r,i,c){var u=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),z(this,"generateCard",(function(){return u._card||u._createCard(),u._card})),z(this,"_createCard",(function(){u._card=document.querySelector(u._cardTemplateSelector).content.cloneNode(!0).children[0],u._img=u._card.querySelector(".element__image"),u._likeCounter=u._card.querySelector(".element__like-counter"),u._img.src=u._data.link,u._img.alt=u._data.name,u._card.querySelector(".element__title").textContent=u._data.name,u._likeCounter.textContent=u._data.likes.length,u._setEventListeners(),u.setLike()})),z(this,"_setEventListeners",(function(){u._card.querySelector(".element__like-button").addEventListener("click",u._handleLikeClick),u._data.isOwner&&u._card.querySelector(".element__delete-button").addEventListener("click",u._handleDeleteIconClick),u._card.querySelector(".element__image").addEventListener("click",u._handleCardClick)})),this._data=t,this._cardTemplateSelector=n,this._handleCardClick=o,this._handleLikeClick=r,this._handleDeleteIconClick=i,this._userId=c,this._isLiked=!1}var t,n;return t=e,(n=[{key:"likeStatus",value:function(){return this._isLiked}},{key:"setLike",value:function(){var e=this;this._data.likes.some((function(t){return t._id===e._userId}))?(this._isLiked=!0,this._card.querySelector(".element__like-button").classList.add("element__like-button_active")):(this._isLiked=!1,this._card.querySelector(".element__like-button").classList.remove("element__like-button_active"))}},{key:"setLikeCounter",value:function(e){this._likeCounter.textContent=e.length,this._data.likes=e}}])&&G(t.prototype,n),e}();function K(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const Q=function e(t,n){var o=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),K(this,"enableValidation",(function(){o._setEventListeners()})),K(this,"_setEventListeners",(function(){o._inputList=Array.from(o._formElement.querySelectorAll(o._objSelectors.inputSelector)),o._buttonElement=o._formElement.querySelector(o._objSelectors.submitButtonSelector),o._toggleButtonState(),o._inputList.forEach((function(e){e.addEventListener("input",(function(){o._checkInputValidity(e),o._toggleButtonState()}))}))})),K(this,"_checkInputValidity",(function(e){e.validity.valid?o._hideInputError(e):o._showInputError(e,e.validationMessage)})),K(this,"_disableSubmitButton",(function(){o._buttonElement.classList.add(o._objSelectors.inactiveButtonClass),o._buttonElement.setAttribute("disabled",!0)})),K(this,"_ableSubmitButton",(function(){o._buttonElement.classList.remove(o._objSelectors.inactiveButtonClass),o._buttonElement.removeAttribute("disabled")})),K(this,"_toggleButtonState",(function(){o._hasInvalidInput()?o._disableSubmitButton():o._ableSubmitButton()})),K(this,"_hasInvalidInput",(function(){return o._inputList.some((function(e){return!1===e.validity.valid}))})),K(this,"_showInputError",(function(e,t){o._errorElement=o._formElement.querySelector(".".concat(e.id,"-error")),e.classList.add(o._objSelectors.inputErrorClass),o._errorElement.textContent=t,o._errorElement.classList.add(o._objSelectors.errorClass)})),K(this,"_hideInputError",(function(e){o._errorElement=o._formElement.querySelector(".".concat(e.id,"-error")),e.classList.remove(o._objSelectors.inputErrorClass),o._errorElement.textContent="",o._errorElement.classList.remove(o._objSelectors.errorClass)})),K(this,"clearForm",(function(){o._disableSubmitButton(),o._inputList.forEach((function(e){o._hideInputError(e)}))})),this._objSelectors=t,this._formElement=n};function W(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var X=new(function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._options=t}var t,n;return t=e,(n=[{key:"getUserInfo",value:function(){return fetch("".concat(this._options.baseUrl,"/users/me"),{method:"GET",headers:this._options.headers})}},{key:"getInitialCards",value:function(){return fetch("".concat(this._options.baseUrl,"/cards"),{method:"GET",headers:this._options.headers})}},{key:"patchUserInfo",value:function(e){return fetch("".concat(this._options.baseUrl,"/users/me"),{method:"PATCH",headers:this._options.headers,body:JSON.stringify(e)})}},{key:"postNewCard",value:function(e){return fetch("".concat(this._options.baseUrl,"/cards"),{method:"POST",headers:this._options.headers,body:JSON.stringify(e)})}},{key:"deleteOwnerCard",value:function(e){return fetch("".concat(this._options.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:this._options.headers})}},{key:"patchAvatar",value:function(e){return fetch("".concat(this._options.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:this._options.headers,body:JSON.stringify(e)})}},{key:"putLike",value:function(e){return fetch("".concat(this._options.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:this._options.headers})}},{key:"deleteLike",value:function(e){return fetch("".concat(this._options.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:this._options.headers})}}])&&W(t.prototype,n),e}())({baseUrl:"https://mesto.nomoreparties.co/v1/cohort-26",headers:{authorization:"c1029b6e-f14f-48d8-a0b9-3627c8971067","Content-Type":"application/json"}});X.getUserInfo().then((function(e){return e.ok?e.json():Promise.reject("Ошибка запроса: ".concat(e.status))})).then((function(e){return _.textContent=e.name,h.textContent=e.about,d.style.backgroundImage="url(".concat(e.avatar,")"),Promise.resolve(e._id)})).then((function(e){X.getInitialCards().then((function(e){return e.ok?e.json():Promise.reject("Ошибка запроса: ".concat(e.status))})).then((function(e){new J({items:e,renderer:function(e){n(e)}},y).renderItems()})).catch((function(e){console.log("Ошибка: ".concat(e))}));var t=new A((function(){}),".popup_type_delete-card");function n(n){n.isOwner=n.owner._id===e;var r=new M(n,n.isOwner?"#cardTemplate":"#cardTemplateUser",(function(){o.open(n.link,n.name,n.name)}),(function(){r.likeStatus()?X.deleteLike(n._id).then((function(e){return e.ok?e.json():Promise.reject("Ошибка при снятии лайка: ".concat(e.status))})).then((function(e){r.setLikeCounter(e.likes),r.setLike()})).catch((function(e){console.log("Ошибка запрос при попытке снять лайк: ".concat(e))})):X.putLike(n._id).then((function(e){return e.ok?e.json():Promise.reject("Ошибка при постановке лайка: ".concat(e.status))})).then((function(e){r.setLikeCounter(e.likes),r.setLike()})).catch((function(e){console.log("Ошибка запроса при попытке поставить лайк: ".concat(e))}))}),(function(e){t.open(),t.setHandleFormSubmit((function(){X.deleteOwnerCard(n._id).then((function(n){n.ok&&(e.target.closest(".element").remove(),t.close())})).catch((function(e){console.log("Ошибка: ".concat(e))}))}))}),e),i=r.generateCard();_.addItem(i)}t.setEventListeners();var o=new R(".popup_type_image");o.setEventListeners();var u=new N({nameSelector:".profile__full-name",roleSelector:".profile__role"}),l=new Q(b,r);l.enableValidation();var s=new C((function(e){X.patchUserInfo(e).then((function(e){return e.ok?e.json():Promise.reject("Ошибка запроса: ".concat(e.status))})).then((function(e){u.setUserInfo(e),s.close()})).catch((function(e){console.log("Ошибка: ".concat(e))}))}),".popup_type_edit",(function(){l.clearForm()}));s.setEventListeners(),f.addEventListener("click",(function(){var e=u.getUserInfo();i.value=e.name,c.value=e.about,s.open()}));var _=new J({items:[],renderer:function(e){n(e)}},y),h=new Q(b,a);h.enableValidation();var v=new C((function(e){X.postNewCard(e).then((function(e){return e.ok?e.json():Promise.reject("Ошибка запроса: ".concat(e.status))})).then((function(e){n(e),v.close()})).catch((function(e){console.log("Ошибка при запросе на создание новой карточки: ".concat(e))}))}),".popup_type_new-card",(function(){h.clearForm()}));v.setEventListeners(),p.addEventListener("click",(function(){v.open()}));var S=new Q(b,m);S.enableValidation();var k=new C((function(e){X.patchAvatar(e).then((function(e){return e.ok?e.json():Promise.reject("Ошибка запроса: ".concat(e.status))})).then((function(e){d.style.backgroundImage="url(".concat(e.avatar,")"),k.close()})).catch((function(e){console.log("Ошибка: ".concat(e))}))}),".popup_type_avatar",(function(){S.clearForm()}));k.setEventListeners(),d.addEventListener("click",(function(){k.open()}))})).catch((function(e){s.style.visibility="hidden",console.log("Ошибка при попытке получения данных о пользователе: ".concat(e))}))})();